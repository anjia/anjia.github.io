
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>JS 模块化编程 | anjia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="anjia">
    
    <meta name="description" content="本篇博客更像是读blog的笔记，是从诸多资料中梳理出了自己的认识。中心思想并非原创。但里面的Q和碎碎念绝对是原创，值得保护，哈哈。
JS 中的模块化编程
以下为《Javascript模块化编程（一）：模块的写法》的笔记，绝大部分示例均取于此。别名：JS 中模块化的发展史、JS 模块的基本写法
理想情">
    
    
    
    
    <link rel="alternate" href="http://anjia.github.io/" title="anjia" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="anjia">anjia</a></h1>
				<h2 class="blog-motto">静下心，慢慢来</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/categories">分类</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/tags">标签</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:anjia.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/05/15/js_module_1/" title="JS 模块化编程" itemprop="url">JS 模块化编程</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://anjia.github.io" title="anjia">anjia</a>
    </p>
  <p class="article-time">
    <time datetime="2015-05-15T03:56:31.000Z" itemprop="datePublished">2015-05-15</time>
    更新日期:<time datetime="2015-05-20T02:30:03.000Z" itemprop="dateModified">2015-05-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JS_中的模块化编程"><span class="toc-number">1.</span> <span class="toc-text">JS 中的模块化编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#模块的基本写法"><span class="toc-number">1.1.</span> <span class="toc-text">模块的基本写法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原始写法"><span class="toc-number">1.1.1.</span> <span class="toc-text">原始写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对象写法"><span class="toc-number">1.1.2.</span> <span class="toc-text">对象写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#立即执行函数"><span class="toc-number">1.1.3.</span> <span class="toc-text">立即执行函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#放大模式"><span class="toc-number">1.1.4.</span> <span class="toc-text">放大模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#宽方法模式"><span class="toc-number">1.1.5.</span> <span class="toc-text">宽方法模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#输入全局变量"><span class="toc-number">1.1.6.</span> <span class="toc-text">输入全局变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">1.2.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q"><span class="toc-number">1.3.</span> <span class="toc-text">Q</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JS_模块规范"><span class="toc-number">2.</span> <span class="toc-text">JS 模块规范</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#两种通行的_JS_模块规范"><span class="toc-number">2.1.</span> <span class="toc-text">两种通行的 JS 模块规范</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CommonJS"><span class="toc-number">2.1.1.</span> <span class="toc-text">CommonJS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AMD"><span class="toc-number">2.1.2.</span> <span class="toc-text">AMD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RequireJS_和_AMD"><span class="toc-number">2.2.</span> <span class="toc-text">RequireJS 和 AMD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AMD_模式小结"><span class="toc-number">2.3.</span> <span class="toc-text">AMD 模式小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q-1"><span class="toc-number">2.4.</span> <span class="toc-text">Q</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AMD_和_CMD"><span class="toc-number">3.</span> <span class="toc-text">AMD 和 CMD</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#区别"><span class="toc-number">3.1.</span> <span class="toc-text">区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#言论1"><span class="toc-number">3.1.1.</span> <span class="toc-text">言论1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#言论2"><span class="toc-number">3.1.2.</span> <span class="toc-text">言论2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#言论3"><span class="toc-number">3.1.3.</span> <span class="toc-text">言论3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他言论"><span class="toc-number">3.2.</span> <span class="toc-text">其他言论</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#碎碎念"><span class="toc-number">3.3.</span> <span class="toc-text">碎碎念</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol>
		</div>
		
		<p>本篇博客更像是读blog的笔记，是从诸多资料中梳理出了自己的认识。中心思想并非原创。<br>但里面的Q和碎碎念绝对是原创，值得保护，哈哈。</p>
<h1 id="JS_中的模块化编程">JS 中的模块化编程</h1>
<p>以下为<a href="http://www.ruanyifeng.com/blog/2012/10/javascript_module.html" target="_blank" rel="external">《Javascript模块化编程（一）：模块的写法》</a>的笔记，绝大部分示例均取于此。<br>别名：JS 中模块化的发展史、JS 模块的基本写法</p>
<p>理想情况下，开发者只需要实现核心的业务逻辑。其他的，就直接加载别人写好的模块即可。<br>但，JS 不是一种模块化编程语言，它不支持类，更别说模块（module）了。<br>但，我们有其他的方式，在现有的环境中实现“模块”的效果。</p>
<h2 id="模块的基本写法">模块的基本写法</h2>
<h3 id="原始写法">原始写法</h3>
<p>模块：实现特定功能的一组方法<br>只要把不同的函数（及记录状态的变量）简单的放在一起，就是一个模块了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">m1</span><span class="params">()</span></span>{</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">m2</span><span class="params">()</span></span>{</div><div class="line">}</div></pre></td></tr></table></figure>

<p>以上的 m1() 和 m2() 就组成了一个模块。使用的时候，直接调用就可以了。</p>
<p>缺点：</p>
<ol>
<li>污染了全局变量：没法保证不与其他模块发生变量名冲突</li>
<li>各模块间的直接关系，看不出来</li>
</ol>
<h3 id="对象写法">对象写法</h3>
<p>为解决上面的问题：把模块写成一个对象，所有模块都放在这个对象里</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> module1 = <span class="keyword">new</span> <span class="built_in">Object</span>({</div><div class="line">	_count: <span class="number">0</span>,</div><div class="line">	m1: <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">	},</div><div class="line">	m2: <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">	}</div><div class="line">});</div></pre></td></tr></table></figure>

<p>m1() 和 m2() 都封装在 module1 对象里。使用时，直接调用这个对象的属性即可。<br>module1.m1();<br>module1.m2();</p>
<p>缺点：</p>
<ol>
<li>暴露所有模块成员，内部状态可被外部改写 module1._count = 10;</li>
</ol>
<h3 id="立即执行函数">立即执行函数</h3>
<p>为解决暴露内部变量的问题：用立即执行函数表达式 IIFE（Immediately-Invoked Function Expression），可以不暴露私有成员</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> module1 = (<span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">	<span class="keyword">var</span> _count = <span class="number">0</span>;</div><div class="line">	<span class="keyword">var</span> m1 = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">	};</div><div class="line">	<span class="keyword">var</span> m2 = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">	};</div><div class="line">	<span class="keyword">return</span> {</div><div class="line">		m1: m1,</div><div class="line">		m2: m2</div><div class="line">	};</div><div class="line">})();</div></pre></td></tr></table></figure>

<p>这，就是 JS 模块的基本写法。下面再对这种写法进行下加工。</p>
<h3 id="放大模式">放大模式</h3>
<p>如果一个模块很大，必须分成几个部分；或者一个模块要继承另一个模块，这时就需要采用“放大模式” augmentation</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> module1 = (<span class="function"><span class="keyword">function</span><span class="params">(mod)</span></span>{</div><div class="line">	mod.m3 = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">	};</div><div class="line">	<span class="keyword">return</span> mod;</div><div class="line">})(module1);</div></pre></td></tr></table></figure>

<p>以上代码为 module1 模块添加了一个新方法 m3()，然后再返回新模块。<br>即给现有的模块上再添砖加瓦-加函数。</p>
<h3 id="宽方法模式">宽方法模式</h3>
<p>在浏览器环境中，模块的各个部分通常是从网上下载的，没法知道哪个部分会先加载。万一原始的 module1 本身还没好，如果执行以上代码这时就加载了一个空对象。这时~ 就需要宽放大模式 Loose augmentation</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> module1 = (<span class="function"><span class="keyword">function</span><span class="params">(mod)</span></span>{</div><div class="line">	<span class="keyword">return</span> mod;</div><div class="line">})(<span class="built_in">window</span>.module1 || {});</div></pre></td></tr></table></figure>

<p>与放大模式相比，它就是立即执行函数的参数可以是空对象。</p>
<h3 id="输入全局变量">输入全局变量</h3>
<p>独立性，是模块的重要特点，即模块内部最好不与程序的其他部分直接交互。<br>所以，如果要在模块内部调用全局变量时，就必须显式地将其他变量输入模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> module1 = (<span class="function"><span class="keyword">function</span><span class="params">($,Yahoo)</span></span>{</div><div class="line">})(jQuery, YAHOO);</div></pre></td></tr></table></figure>

<p>模块 module1 需要使用 jQuery库 和 YUI库，就把这两个库（其实就是两模块）当做参数传给 module1。<br>好处：</p>
<ol>
<li>保证了模块的独立性</li>
<li>模块之间的依赖关系变得比较明显<br>更多讨论见：<a href="http://www.adequatelygood.com/JavaScript-Module-Pattern-In-Depth.html" target="_blank" rel="external">《JS Module Pattern: In-Depth》</a></li>
</ol>
<h2 id="小结">小结</h2>
<p>模块，即实现特定功能的一组方法。它应该满足的特性及对应的解决办法如下：</p>
<p><strong>基本的：</strong></p>
<ol>
<li>避免污染全局变量：“对象封装”</li>
<li>不暴露对象的私有变量：IIFE</li>
</ol>
<p><strong>好点的：</strong></p>
<ol>
<li>模块要独立：显示地将其他变量当参数传入（独立：内部不和程序的其他部分直接交互）</li>
<li>模块间的关系，要清晰：当参数传入。关系比如是依赖（组装、扩展）</li>
<li>依赖关系的先后顺序：</li>
</ol>
<h2 id="Q">Q</h2>
<p>1.据说：ECMAScript6支持类和模块了<br>2.何为模块化编程语言？<br>3.即立即执行匿名函数（// Q：匿名函数~~  匿名函数的好处~也补上呗！）<br>4.浏览器环境下，模块的各个部分通常是从网上下载的（为何不能是本地的？当自己开发时-就是纯本地的吧。当是访问url时，就是从网上下载了）<br>5.浏览器环境下：组织不同的模块，管理模块间的依赖性<br>6.与放大模式相比，宽模式就是立即执行函数的参数可以是空对象。那么：问题是解决了，但是应用的场景呢？既然要在它的基础上扩展，它都没有，还扩展个毛线线啊？….or 我想知道应用场景~~（你看，这个时候不丰富的项目经验…一下子就成了软肋。）</p>
<p>开启碎碎念模式：<br>要我说呀，这些所谓的模式，名字听起来都很高大上的样子，但其实…其实就是为了解决一个普通的问题（所以，把它之所以诞生的原因搞清楚就可以了）。没必要去记模式名字。就了解下：遇到了什么问题-如何解决的。当然不排斥知道这些名词 有助于自己聊天 扯淡。呵呵。</p>
<h1 id="JS_模块规范">JS 模块规范</h1>
<h2 id="两种通行的_JS_模块规范">两种通行的 JS 模块规范</h2>
<p>为什么要使用模块？因为要方便使用别人的代码…拿个积木-直接搭；不用关心内部实现，只看暴露出来的接口想要什么功能，就加载什么模块。嗯~就是这么简单。</p>
<p>但是，有个前提：即大家都按照相同的方式编写代码（否则各按各的，就没法统一了）。再加上，JS 模块现在依然没有官方规范，这就显得更重要了。</p>
<p>目前，通行的 JS 模块规范共有两种：CommonJS 和 AMD。<br>讲 AMD 之前，先说说 CommonJS</p>
<h3 id="CommonJS">CommonJS</h3>
<p>2009年，某人创造了 node.js 项目，将 JS 用于服务器端编程。这标志着：JS 模块化编程正式诞生。<br>据说，在浏览器环境下，没有模块也不是特别大的问题，毕竟网页程序的复杂性有限。但在服务器端，一定要有模块，与操作系统和其他程序互动，否则就没法编程。<br>node.js 的模块系统，就是参考 CommonJS 规范实现的。在 CommonJS 中，有一个全局性方法 require() 方法，用于加载模块。假如有一个 math.js 模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);  <span class="comment">//加载该模块</span></div><div class="line">math.add(<span class="number">2</span>,<span class="number">3</span>);   <span class="comment">//调用模块提供的方法</span></div></pre></td></tr></table></figure>

<p>此系列主要针对浏览器编程，不涉及 node.js，所以对 CommonJS 就不多说了。只要知道 require() 用于加载模块就行了。</p>
<p>浏览器环境：<br>有了服务器端模块后，自然，大家想要客户端模块。而且最好两者能够兼容，一个模块不用修改，可以同时在服务器和浏览器同时运行。但是，有个很大的局限，使得 CommonJS 规范不适用于浏览器环境。如果在浏览器中运行，会有啥问题？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</div><div class="line">math.add(<span class="number">2</span>,<span class="number">3</span>);</div></pre></td></tr></table></figure>

<p>add() 必须等第一行加载完后。也就是说，如果加载时间很长，整个应用就被阻塞在那了。</p>
<p>这对服务器不是个问题。因为所有的模块都存放在本地硬盘，可以同步加载完成。等待的时间就是硬盘的读取时间。但是，这对于浏览器就是一个大问题：因为模块都放在服务器端，等待时间取决于网速的快慢。可能要等很长时间，浏览器处于假死状态。</p>
<p>所以，浏览器的模块，不能采用同步加载 synchronous，只能采用异步加载 asynchronous。<br>这就是 AMD 规范诞生的背景。</p>
<h3 id="AMD">AMD</h3>
<p>Asynchronous Module Definition    //[e’sɪŋkrənəs]<br>异步模块定义</p>
<p>它采用异步的方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数里，等加载完毕后，再执行这个回调。</p>
<p>AMD 也采用 require() 语句加载模块，但是不同于 CommonJS，它要求两个参数：<br>require([module], callback);<br>[module] 是一个数组，里面的成员就是要加载的模块<br>callback 是加载成功后的回调函数</p>
<p>如果把前面的代码改成 AMD 形式，就是这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>([<span class="string">'math'</span>], <span class="function"><span class="keyword">function</span><span class="params">(math)</span></span>{</div><div class="line">	math.add(<span class="number">2</span>,<span class="number">3</span>);</div><div class="line">});</div></pre></td></tr></table></figure>

<p>math.add() 的执行和 math.js 的加载是异步的，浏览器不会发生假死。这就是适合于浏览器环境的 AMD。</p>
<p>实现了 AMD 规范的库<br>require.js //通过介绍它 进一步讲解AMD的用法 和 如何将模块化编程投入实战<br>curl.js </p>
<h2 id="RequireJS_和_AMD">RequireJS 和 AMD</h2>
<p>requireJS 就是一个工具库，用户客户端的模块化管理。它让客户端的代码，可以分成一个模块，实现异步或动态加载 - 提高代码的性能和维护性。它的模块管理遵守 AMD 规范。</p>
<p>怎么使用 requireJS：<br>通过 define() 将代码定义成模块<br>通过 require() 实现代码的模块加载<br>要求每个模块单独放在一个单独的文件里</p>
<p>关于 requireJS 的入门介绍可参考之前的一篇博客 <a href="http://anjia.github.io/2015/04/17/fe_requireJS/" target="_blank" rel="external">requireJS</a>，以下内容是对此篇内容的补充。<br>当依赖模块很多时…参数和模块一一对应，就太麻烦了，可以这样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span><span class="params">(require)</span></span>{</div><div class="line">	<span class="keyword">var</span> dep1 = <span class="built_in">require</span>(<span class="string">'dep1'</span>),</div><div class="line">		dep2 = <span class="built_in">require</span>(<span class="string">'dep2'</span>),</div><div class="line">		dep3 = <span class="built_in">require</span>(<span class="string">'dep3'</span>),</div><div class="line">		dep4 = <span class="built_in">require</span>(<span class="string">'dep4'</span>),</div><div class="line">		dep5 = <span class="built_in">require</span>(<span class="string">'dep5'</span>),</div><div class="line">		...;</div><div class="line">	<span class="comment">//遍历文件夹，把每个文件都给require进来</span></div><div class="line">	<span class="comment">//or 一个人自己的书单....</span></div><div class="line">	<span class="comment">//or 一本书生成一个.js 想用的时候就require进来？但是它的接口是？</span></div><div class="line">});</div></pre></td></tr></table></figure>

<p><a href="http://www.douban.com/note/283566440/" target="_blank" rel="external">有人评论说：</a>「define 后面跟着一长串的依赖感觉就像一场噩梦」，这个确实是个问题。我暂时的处理办法是通过 Sublime Text 插件来自动管理 AMD 依赖。当然这样只是让书写上更便捷，视觉上依赖数组一大坨还是不太美观。</p>
<p>//以上是异步加载</p>
<p>//下面是动态加载<br><a href="http://javascript.ruanyifeng.com/tool/requirejs.html" target="_blank" rel="external">http://javascript.ruanyifeng.com/tool/requirejs.html</a><br>可以根据 isReady 属性的值，决定下一步的动作</p>
<p>//服务器端采用 JSONP 模式，则可直接在 require 调用，来看下面的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>([</div><div class="line">	<span class="string">"http://someapi.com/foo?callback=define"</span></div><div class="line">],</div><div class="line"><span class="function"><span class="keyword">function</span><span class="params">(data)</span></span>{ <span class="comment">//</span></div><div class="line">	<span class="built_in">console</span>.log(data);  <span class="comment">// VS. ajax 呢？？</span></div><div class="line">},</div><div class="line"><span class="function"><span class="keyword">function</span><span class="params">(err)</span></span>{ <span class="comment">//处理错误的回调函数</span></div><div class="line">});</div><div class="line"><span class="comment">//指定一个全局性的Error事件的监听函数</span></div><div class="line">requirejs.onError = <span class="function"><span class="keyword">function</span><span class="params">(err)</span></span>{</div><div class="line">};</div></pre></td></tr></table></figure>

<h2 id="AMD_模式小结">AMD 模式小结</h2>
<ol>
<li>define() 和 require() 这两个定义模块、调用模块的方法，合称为 AMD 模式</li>
<li>定义模块时：清晰，不会污染全局环境，且能清楚的显示依赖关系</li>
<li>AMD 模式可以用于浏览器环境，并且允许非同步加载模块，也可以根据需要动态加载模块。</li>
</ol>
<h2 id="Q-1">Q</h2>
<p>1.目前，通行的JS模块规范共有两种：CommonJS 和 AMD   //Q：不是是AMD和CMD么？[莫非这是前端的~]<br>2.动态加载JS的应用场景：eg.当用户是否登录的时候-页面不同-加载的东东也就不同？eg.如果浏览器本身就支持 JSON 那就直接原生的，否则就用第三方的库<br>3.嗯~ 模块也可以是路径样子….Q：路径 和 模块名 它是如何查找的？？<br>4.JSONP</p>
<h1 id="AMD_和_CMD">AMD 和 CMD</h1>
<h2 id="区别">区别</h2>
<h3 id="言论1">言论1</h3>
<p><a href="http://www.zhihu.com/question/20351507" target="_blank" rel="external">玉伯说：</a> “<br>AMD 是 RequireJS 在推广过程中对模块定义的规范化产出。<br>CMD 是 SeaJS 在推广过程中对模块定义的规范化产出。<br>类似的还有 CommonJS Modules/2.0 规范，是 BravoJS 在推广过程中对模块定义的规范化产出。<br>还有不少…”<br>这些规范都是为了JS的模块化开发，特别是在浏览器端。</p>
<h3 id="言论2">言论2</h3>
<p><a href="https://www.imququ.com/post/amd-simplified-commonjs-wrapping.html" target="_blank" rel="external">屈屈说：</a> “<br>AMD 运行时核心思想是「Early Executing」，也就是提前执行依赖。这个好理解。<br>CMD 按需执行依赖可以避免浪费，但是带来更长的等待时间。</p>
<p>因为 CommonJS Wrapper 并不会改变 AMD「尽早执行」依赖的本质！</p>
<p>我觉得「尽早执行」或「按需执行」两种策略没有明显的优劣之分，但 AMD 这种「模仿别人写法，却提供不一样的特性」这个做法十分愚蠢。这年头，做自己最重要！</p>
<p>SeaJS 对模块的态度是懒执行, 而 RequireJS 对模块的态度是预执行。<br>”</p>
<h3 id="言论3">言论3</h3>
<p>至此可以对由 commonJS 衍生出来的方案做出总结了。在浏览器端来设计模块加载机制，需要考虑依赖的问题。我们先把依赖分为两种：</p>
<ol>
<li>“强依赖” —— 肯定需要 </li>
<li>“弱依赖” —— 可能需要</li>
</ol>
<p>对于强依赖<br>如果要性能优先，则考虑参照依赖前置的思想设计你的模块加载器，我个人也更推崇这个方案一些；<br>如果考虑开发成本优先，则考虑按照依赖就近的思想设计你的模块加载器。</p>
<p>对于弱依赖<br>只需要将弱依赖的部分改写到回调函数内即可。<br>如果现在我要实现一个模块加载器，我会将强依赖前置，弱依赖采用异步回调函数的形式，其它的方法我认为都只是语法糖而已，仅此就够了。</p>
<h2 id="其他言论">其他言论</h2>
<ol>
<li>建议取消使用 CMD 这个名称，统一使用 CommonJS 规范称谓</li>
<li>AMD 代码是 requirejs，CMD 则是 seajs</li>
<li>加载模块时：AMD 提前加载，依赖前置；CMD 延迟加载，依赖就近。</li>
<li>正如玉伯所说：RequireJS 和 Sea.js 都是模块加载器，倡导模块化开发理念，核心价值是让 JavaScript 的模块化开发变得简单自然。 </li>
<li>根据我大量的阅读文档，在遵循一定的写法，感觉这两个都能实现一样的功能。只是作者在推广其思想要如何如何。 </li>
</ol>
<h2 id="碎碎念">碎碎念</h2>
<p>果然 AMD 和 CMD 的讨论很是激烈。之前 <a href="http://www.75team.com/" target="_blank" rel="external">75团</a> 的分享上有一次，某人的开场是这样的“今天，我们不讨论 AMD 好还是 CMD 好。今天我们只分享在图搜中的JS模块化应用”。</p>
<p>有时候吧，会觉得，之所以争的如此激烈，是因为有些人只用过了a，且用a的思路去试着用b，结果踩了好多坑（或者这根本就不是坑-而是没用对）又或者是抱着去验证而不是去学习的心态去用，结果可想而知。又或许有一些只用了个皮毛的入门人士，就来网上装作很有经验的样子去大肆批判这个，表扬那个，于是整个空气便浑浊了。看似硝烟弥漫的严肃紧张，实则是背后杂乱无章的瞎嚷嚷。</p>
<p>我个人觉得，对待技术本身：能解决碰到的问题就ok了。至于哪个好哪个不好，没必要争论个你死我活。要讨论就讨论每个的优缺点就可以了，优缺点其实也就是应用场景了。而且，优缺点是可以变的，语言也是在不断根据程序员的需求慢慢变化的….但针锋相对地吵架，就没啥实际意义了，最多是技术圈里的挑话题，炒作 or 刷存在感？</p>
<p>若要真的讨论两者的好坏，那就先做做功课。<br>1.去看源码。。。理解真正的思想是什么？原理是什么？<br>2.写出符合规范的代码，去浏览器&amp;实际项目中测试性能。。。<br>3.依据正确的场景去正确的用东西。。<br>理论和实战相结合后，且有个结论了之后，再来清清楚楚明明白白的争辩。</p>
<h1 id="参考">参考</h1>
<p>JS 的模块化编程（一、二）：通俗易懂<br><a href="http://www.ruanyifeng.com/blog/2012/10/javascript_module.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2012/10/javascript_module.html</a><br><a href="http://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html</a></p>
<p>RequireJS 和 AMD 规范<br><a href="http://javascript.ruanyifeng.com/tool/requirejs.html" target="_blank" rel="external">http://javascript.ruanyifeng.com/tool/requirejs.html</a></p>
<p>AMD：<a href="https://github.com/amdjs/amdjs-api/wiki/AMD" target="_blank" rel="external">https://github.com/amdjs/amdjs-api/wiki/AMD</a><br>CMD：<a href="https://github.com/seajs/seajs/issues/242" target="_blank" rel="external">https://github.com/seajs/seajs/issues/242</a><br>CommonJS：<a href="http://wiki.commonjs.org/wiki/Modules/1.1" target="_blank" rel="external">http://wiki.commonjs.org/wiki/Modules/1.1</a> </p>
<p>AMD 和 CMD 的讨论：<br><a href="http://www.zhihu.com/question/20351507" target="_blank" rel="external">http://www.zhihu.com/question/20351507</a><br><a href="http://www.zhihu.com/question/21347409#answer-2323656" target="_blank" rel="external">http://www.zhihu.com/question/21347409#answer-2323656</a><br><a href="http://www.zhihu.com/question/20342350" target="_blank" rel="external">http://www.zhihu.com/question/20342350</a></p>
<p><a href="http://www.douban.com/note/283566440/" target="_blank" rel="external">http://www.douban.com/note/283566440/</a><br><a href="https://www.imququ.com/post/amd-simplified-commonjs-wrapping.html" target="_blank" rel="external">https://www.imququ.com/post/amd-simplified-commonjs-wrapping.html</a></p>
<p>【译】使用 AMD、CommonJS 及 ES Harmony 编写模块化的<br>JavaScript：<a href="http://justineo.github.io/singles/writing-modular-js/" target="_blank" rel="external">http://justineo.github.io/singles/writing-modular-js/</a>  </p>
<p>JavaScript模块化开发（三）——AMD规范<br><a href="http://www.feeldesignstudio.com/2013/09/javascript-module-pattern-amd/" target="_blank" rel="external">http://www.feeldesignstudio.com/2013/09/javascript-module-pattern-amd/</a></p>
<p>AMD规范：简单而优雅的动态载入JavaScript代码<br><a href="http://blog.csdn.net/dojotoolkit/article/details/6076668" target="_blank" rel="external">http://blog.csdn.net/dojotoolkit/article/details/6076668</a></p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/javascript/">javascript</a><a href="/tags/模块化/">模块化</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/javascript/">javascript</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://anjia.github.io/2015/05/15/js_module_1/" data-title="JS 模块化编程 | anjia" data-tsina="undefined" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/05/19/tool_git_usage/" title="Git 命令">
  <strong>上一篇:</strong><br/>
  <span>
  Git 命令</span>
</a>
</div>


<div class="next">
<a href="/2015/05/12/regExp_js_1/"  title="JS 中的 RegExp 类型">
 <strong>下一篇:</strong><br/> 
 <span>JS 中的 RegExp 类型
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JS_中的模块化编程"><span class="toc-number">1.</span> <span class="toc-text">JS 中的模块化编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#模块的基本写法"><span class="toc-number">1.1.</span> <span class="toc-text">模块的基本写法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原始写法"><span class="toc-number">1.1.1.</span> <span class="toc-text">原始写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对象写法"><span class="toc-number">1.1.2.</span> <span class="toc-text">对象写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#立即执行函数"><span class="toc-number">1.1.3.</span> <span class="toc-text">立即执行函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#放大模式"><span class="toc-number">1.1.4.</span> <span class="toc-text">放大模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#宽方法模式"><span class="toc-number">1.1.5.</span> <span class="toc-text">宽方法模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#输入全局变量"><span class="toc-number">1.1.6.</span> <span class="toc-text">输入全局变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">1.2.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q"><span class="toc-number">1.3.</span> <span class="toc-text">Q</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JS_模块规范"><span class="toc-number">2.</span> <span class="toc-text">JS 模块规范</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#两种通行的_JS_模块规范"><span class="toc-number">2.1.</span> <span class="toc-text">两种通行的 JS 模块规范</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CommonJS"><span class="toc-number">2.1.1.</span> <span class="toc-text">CommonJS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AMD"><span class="toc-number">2.1.2.</span> <span class="toc-text">AMD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RequireJS_和_AMD"><span class="toc-number">2.2.</span> <span class="toc-text">RequireJS 和 AMD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AMD_模式小结"><span class="toc-number">2.3.</span> <span class="toc-text">AMD 模式小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q-1"><span class="toc-number">2.4.</span> <span class="toc-text">Q</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AMD_和_CMD"><span class="toc-number">3.</span> <span class="toc-text">AMD 和 CMD</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#区别"><span class="toc-number">3.1.</span> <span class="toc-text">区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#言论1"><span class="toc-number">3.1.1.</span> <span class="toc-text">言论1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#言论2"><span class="toc-number">3.1.2.</span> <span class="toc-text">言论2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#言论3"><span class="toc-number">3.1.3.</span> <span class="toc-text">言论3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他言论"><span class="toc-number">3.2.</span> <span class="toc-text">其他言论</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#碎碎念"><span class="toc-number">3.3.</span> <span class="toc-text">碎碎念</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类目录</p>
		<ul>
		
			<li>
				<a href="/categories/CSS/" title="CSS">CSS (5)</a></li>
		
			<li>
				<a href="/categories/FE/" title="FE">FE (1)</a></li>
		
			<li>
				<a href="/categories/HTML/" title="HTML">HTML (6)</a></li>
		
			<li>
				<a href="/categories/Web/" title="Web">Web (3)</a></li>
		
			<li>
				<a href="/categories/blog/" title="blog">blog (4)</a></li>
		
			<li>
				<a href="/categories/javascript/" title="javascript">javascript (14)</a></li>
		
			<li>
				<a href="/categories/node/" title="node">node (2)</a></li>
		
			<li>
				<a href="/categories/tool/" title="tool">tool (6)</a></li>
		
			<li>
				<a href="/categories/后端/" title="后端">后端 (3)</a></li>
		
			<li>
				<a href="/categories/实战/" title="实战">实战 (3)</a></li>
		
			<li>
				<a href="/categories/实战知识点/" title="实战知识点">实战知识点 (3)</a></li>
		
			<li>
				<a href="/categories/翻译/" title="翻译">翻译 (3)</a></li>
		
		</ul>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">文章归档</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05">May 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04">April 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03">March 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02">February 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11">November 2014</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09">September 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08">August 2014</a><span class="archive-list-count">12</span></li></ul>
  </div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/CSS/" style="font-size: 18.33px;">CSS</a><a href="/tags/FE/" style="font-size: 10.00px;">FE</a><a href="/tags/HTML/" style="font-size: 16.67px;">HTML</a><a href="/tags/HTML5/" style="font-size: 10.00px;">HTML5</a><a href="/tags/canvas/" style="font-size: 10.00px;">canvas</a><a href="/tags/debug/" style="font-size: 10.00px;">debug</a><a href="/tags/hexo/" style="font-size: 10.00px;">hexo</a><a href="/tags/javascript/" style="font-size: 20.00px;">javascript</a><a href="/tags/js高级程序设计/" style="font-size: 13.33px;">js高级程序设计</a><a href="/tags/markdown/" style="font-size: 10.00px;">markdown</a><a href="/tags/shortcut-key/" style="font-size: 10.00px;">shortcut key</a><a href="/tags/todo/" style="font-size: 13.33px;">todo</a><a href="/tags/tool/" style="font-size: 15.00px;">tool</a><a href="/tags/web/" style="font-size: 13.33px;">web</a><a href="/tags/实战/" style="font-size: 16.67px;">实战</a><a href="/tags/对象/" style="font-size: 13.33px;">对象</a><a href="/tags/杂谈/" style="font-size: 11.67px;">杂谈</a><a href="/tags/模块化/" style="font-size: 10.00px;">模块化</a><a href="/tags/模板/" style="font-size: 13.33px;">模板</a><a href="/tags/正则表达式/" style="font-size: 13.33px;">正则表达式</a><a href="/tags/笔记/" style="font-size: 11.67px;">笔记</a><a href="/tags/编码/" style="font-size: 11.67px;">编码</a><a href="/tags/翻译/" style="font-size: 13.33px;">翻译</a><a href="/tags/读书笔记/" style="font-size: 13.33px;">读书笔记</a><a href="/tags/跨域/" style="font-size: 13.33px;">跨域</a><a href="/tags/转义/" style="font-size: 10.00px;">转义</a>
    </div>
  </div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    
        <a href="http://www.75team.com/" target="_blank">奇舞团</a>
    
        <a href="https://www.imququ.com/" target="_blank">JerryQu 的小站</a>
    
        <a href="http://www.welefen.com/" target="_blank">welefen的随笔</a>
    
        <a href="http://chevion.github.io/" target="_blank">chevionlu</a>
    
        <a href="http://www.cnblogs.com/jkisjk/" target="_blank">JKisJK</a>
    
        <a href="http://www.ivershuo.com/2014/04/fastcgi_on_nodejs/" target="_blank">阿肆</a>
    
        <a href="http://hszy00232.blog.163.com/blog" target="_blank">冰果</a>
    
        <a href="http://www.cnblogs.com/snadn/category/485724.html" target="_blank">snadn</a>
    
        <a href="http://blog.csdn.net/mine666" target="_blank">mine666</a>
    
        <a href="http://jiaolonghuang.github.io/" target="_blank">JiaoLong_H</a>
    
        <a href="http://hujunil.github.io/" target="_blank">Hujun</a>
    
        <a href="http://my.oschina.net/u/1589874/blog?catalog=472902" target="_blank">Sunny_lyy</a>
    
        <a href="http://blog.justoffline.com/index.html" target="_blank">少说绝对</a>
    
        <a href="http://www.zhangxinxu.com/wordpress/" target="_blank">张鑫旭</a>
    
        <a href="http://www.aoao.org.cn/blog/" target="_blank">嗷嗷</a>
    
        <a href="http://hikejun.com/blog/" target="_blank">Kejun</a>
    
        <a href="http://www.ruanyifeng.com/blog/archives.html" target="_blank">阮一峰</a>
    
        <a href="http://melonh.com/" target="_blank">Melon瓜瓜</a>
    
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	<p class="copyright">© 2015 - 
	
	<a href="http://anjia.github.io" target="_blank" title="anjia">anjia</a>
	 - Powered by hexo and Theme by Pacman
	</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 






  </body>
</html>
